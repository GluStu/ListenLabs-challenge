import requests 

BASE_URL = "https://berghain.challenges.listenlabs.ai"
PLAYER_ID = "" #Your player ID
SCENARIO = 1

print("Starting new game...")
try:
    res = requests.get(f"{BASE_URL}/new-game?scenario={SCENARIO}&playerId={PLAYER_ID}")
    res.raise_for_status()
    game = res.json()
except Exception as e:
    print("Failed to start game:", e)
    exit(1)

game_id = game["gameId"]
constraints = game["constraints"]
rel_freq = game["attributeStatistics"]["relativeFrequencies"]

print(f"Game ID: {game_id}")


try:
    url = f"{BASE_URL}/decide-and-next?gameId={game_id}&personIndex=0"
    res = requests.get(url)
    res.raise_for_status()
    data = res.json()
    current_person = data["nextPerson"]
except Exception as e:
    print("Failed to get first person:", e)
    exit(1)

person_index = 0
cmp = False
yng = 0
wd = 0
while True:
    try:
        attrs = current_person["attributes"]
        is_young = attrs.get("young", False)
        if is_young:
            yng += 1.02
        is_well_dressed = attrs.get("well_dressed", False)
        if is_well_dressed:
            wd += 1.02
        if yng >= 580 or wd >= 580:
            cmp = True
        accept = is_young or is_well_dressed or cmp
        decision = "ACCEPT" if accept else "REJECT"

        print(f"[{current_person['personIndex']}] Young: {is_young}, Well Dressed: {is_well_dressed} => {decision}, yng cnt: {yng}, wd cnt: {wd}")

        url = f"{BASE_URL}/decide-and-next?gameId={game_id}&personIndex={person_index}&accept={str(accept).lower()}"
        res = requests.get(url)
        res.raise_for_status()
        data = res.json()

        current_person = data["nextPerson"]
        person_index += 1

    except requests.exceptions.RequestException as e:
        print("HTTP request failed:", e)
        break
    except Exception as e:
        print("Unexpected error:", e)
        break
